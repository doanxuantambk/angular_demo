{"remainingRequest":"/Users/tamdx/github/angular_demo/node_modules/thread-loader/dist/cjs.js??ref--9-2!/Users/tamdx/github/angular_demo/node_modules/ts-loader/index.js??ref--9-3!/Users/tamdx/github/angular_demo/node_modules/eslint-loader/dist/cjs.js!/Users/tamdx/github/angular_demo/src/main/webapp/app/core/auth/account.service.ts","dependencies":[{"path":"/Users/tamdx/github/angular_demo/src/main/webapp/app/core/auth/account.service.ts","mtime":1576505417530},{"path":"/Users/tamdx/github/angular_demo/node_modules/angular2-template-loader/index.js","mtime":1486570058000},{"path":"/Users/tamdx/github/angular_demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tamdx/github/angular_demo/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tamdx/github/angular_demo/node_modules/ts-loader/index.js","mtime":499162500000},{"path":"/Users/tamdx/github/angular_demo/node_modules/eslint-loader/dist/cjs.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICogYXMgdHNsaWJfMSBmcm9tICJ0c2xpYiI7CnZhciBfYSwgX2IsIF9jOwppbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7CmltcG9ydCB7IEpoaUxhbmd1YWdlU2VydmljZSB9IGZyb20gJ25nLWpoaXBzdGVyJzsKaW1wb3J0IHsgU2Vzc2lvblN0b3JhZ2VTZXJ2aWNlIH0gZnJvbSAnbmd4LXdlYnN0b3JhZ2UnOwppbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnOwppbXBvcnQgeyBTdWJqZWN0LCBvZiB9IGZyb20gJ3J4anMnOwppbXBvcnQgeyBzaGFyZVJlcGxheSwgdGFwLCBjYXRjaEVycm9yIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnOwppbXBvcnQgeyBTRVJWRVJfQVBJX1VSTCB9IGZyb20gJ2FwcC9hcHAuY29uc3RhbnRzJzsKbGV0IEFjY291bnRTZXJ2aWNlID0gY2xhc3MgQWNjb3VudFNlcnZpY2UgewogICAgY29uc3RydWN0b3IobGFuZ3VhZ2VTZXJ2aWNlLCBzZXNzaW9uU3RvcmFnZSwgaHR0cCkgewogICAgICAgIHRoaXMubGFuZ3VhZ2VTZXJ2aWNlID0gbGFuZ3VhZ2VTZXJ2aWNlOwogICAgICAgIHRoaXMuc2Vzc2lvblN0b3JhZ2UgPSBzZXNzaW9uU3RvcmFnZTsKICAgICAgICB0aGlzLmh0dHAgPSBodHRwOwogICAgICAgIHRoaXMuYXV0aGVudGljYXRlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuYXV0aGVudGljYXRpb25TdGF0ZSA9IG5ldyBTdWJqZWN0KCk7CiAgICB9CiAgICBmZXRjaCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldChTRVJWRVJfQVBJX1VSTCArICdhcGkvYWNjb3VudCcpOwogICAgfQogICAgc2F2ZShhY2NvdW50KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KFNFUlZFUl9BUElfVVJMICsgJ2FwaS9hY2NvdW50JywgYWNjb3VudCk7CiAgICB9CiAgICBhdXRoZW50aWNhdGUoaWRlbnRpdHkpIHsKICAgICAgICB0aGlzLnVzZXJJZGVudGl0eSA9IGlkZW50aXR5OwogICAgICAgIHRoaXMuYXV0aGVudGljYXRlZCA9IGlkZW50aXR5ICE9PSBudWxsOwogICAgICAgIHRoaXMuYXV0aGVudGljYXRpb25TdGF0ZS5uZXh0KHRoaXMudXNlcklkZW50aXR5KTsKICAgIH0KICAgIGhhc0FueUF1dGhvcml0eShhdXRob3JpdGllcykgewogICAgICAgIGlmICghdGhpcy5hdXRoZW50aWNhdGVkIHx8ICF0aGlzLnVzZXJJZGVudGl0eSB8fCAhdGhpcy51c2VySWRlbnRpdHkuYXV0aG9yaXRpZXMpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoYXV0aG9yaXRpZXMpKSB7CiAgICAgICAgICAgIGF1dGhvcml0aWVzID0gW2F1dGhvcml0aWVzXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGF1dGhvcml0aWVzLnNvbWUoKGF1dGhvcml0eSkgPT4gdGhpcy51c2VySWRlbnRpdHkuYXV0aG9yaXRpZXMuaW5jbHVkZXMoYXV0aG9yaXR5KSk7CiAgICB9CiAgICBpZGVudGl0eShmb3JjZSkgewogICAgICAgIGlmIChmb3JjZSB8fCAhdGhpcy5hdXRoZW50aWNhdGVkKSB7CiAgICAgICAgICAgIHRoaXMuYWNjb3VudENhY2hlJCA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGlmICghdGhpcy5hY2NvdW50Q2FjaGUkKSB7CiAgICAgICAgICAgIHRoaXMuYWNjb3VudENhY2hlJCA9IHRoaXMuZmV0Y2goKS5waXBlKGNhdGNoRXJyb3IoKCkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIG9mKG51bGwpOwogICAgICAgICAgICB9KSwgdGFwKGFjY291bnQgPT4gewogICAgICAgICAgICAgICAgaWYgKGFjY291bnQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJJZGVudGl0eSA9IGFjY291bnQ7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hdXRoZW50aWNhdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAvLyBBZnRlciByZXRyaWV2ZSB0aGUgYWNjb3VudCBpbmZvLCB0aGUgbGFuZ3VhZ2Ugd2lsbCBiZSBjaGFuZ2VkIHRvCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHVzZXIncyBwcmVmZXJyZWQgbGFuZ3VhZ2UgY29uZmlndXJlZCBpbiB0aGUgYWNjb3VudCBzZXR0aW5nCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudXNlcklkZW50aXR5LmxhbmdLZXkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFuZ0tleSA9IHRoaXMuc2Vzc2lvblN0b3JhZ2UucmV0cmlldmUoJ2xvY2FsZScpIHx8IHRoaXMudXNlcklkZW50aXR5LmxhbmdLZXk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmNoYW5nZUxhbmd1YWdlKGxhbmdLZXkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMudXNlcklkZW50aXR5ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmF1dGhlbnRpY2F0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuYXV0aGVudGljYXRpb25TdGF0ZS5uZXh0KHRoaXMudXNlcklkZW50aXR5KTsKICAgICAgICAgICAgfSksIHNoYXJlUmVwbGF5KCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50Q2FjaGUkOwogICAgfQogICAgaXNBdXRoZW50aWNhdGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLmF1dGhlbnRpY2F0ZWQ7CiAgICB9CiAgICBpc0lkZW50aXR5UmVzb2x2ZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudXNlcklkZW50aXR5ICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICBnZXRBdXRoZW50aWNhdGlvblN0YXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLmF1dGhlbnRpY2F0aW9uU3RhdGUuYXNPYnNlcnZhYmxlKCk7CiAgICB9CiAgICBnZXRJbWFnZVVybCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5pc0lkZW50aXR5UmVzb2x2ZWQoKSA/IHRoaXMudXNlcklkZW50aXR5LmltYWdlVXJsIDogbnVsbDsKICAgIH0KfTsKQWNjb3VudFNlcnZpY2UgPSB0c2xpYl8xLl9fZGVjb3JhdGUoWwogICAgSW5qZWN0YWJsZSh7IHByb3ZpZGVkSW46ICdyb290JyB9KSwKICAgIHRzbGliXzEuX19tZXRhZGF0YSgiZGVzaWduOnBhcmFtdHlwZXMiLCBbdHlwZW9mIChfYSA9IHR5cGVvZiBKaGlMYW5ndWFnZVNlcnZpY2UgIT09ICJ1bmRlZmluZWQiICYmIEpoaUxhbmd1YWdlU2VydmljZSkgPT09ICJmdW5jdGlvbiIgPyBfYSA6IE9iamVjdCwgdHlwZW9mIChfYiA9IHR5cGVvZiBTZXNzaW9uU3RvcmFnZVNlcnZpY2UgIT09ICJ1bmRlZmluZWQiICYmIFNlc3Npb25TdG9yYWdlU2VydmljZSkgPT09ICJmdW5jdGlvbiIgPyBfYiA6IE9iamVjdCwgdHlwZW9mIChfYyA9IHR5cGVvZiBIdHRwQ2xpZW50ICE9PSAidW5kZWZpbmVkIiAmJiBIdHRwQ2xpZW50KSA9PT0gImZ1bmN0aW9uIiA/IF9jIDogT2JqZWN0XSkKXSwgQWNjb3VudFNlcnZpY2UpOwpleHBvcnQgeyBBY2NvdW50U2VydmljZSB9Owo="},{"version":3,"file":"/Users/tamdx/github/angular_demo/src/main/webapp/app/core/auth/account.service.ts","sourceRoot":"","sources":["/Users/tamdx/github/angular_demo/node_modules/eslint-loader/dist/cjs.js!/Users/tamdx/github/angular_demo/src/main/webapp/app/core/auth/account.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\nimport { JhiLanguageService } from 'ng-jhipster';\nimport { SessionStorageService } from 'ngx-webstorage';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, Subject, of } from 'rxjs';\nimport { shareReplay, tap, catchError } from 'rxjs/operators';\n\nimport { SERVER_API_URL } from 'app/app.constants';\nimport { Account } from 'app/core/user/account.model';\n\n@Injectable({ providedIn: 'root' })\nexport class AccountService {\n  private userIdentity: Account;\n  private authenticated = false;\n  private authenticationState = new Subject<any>();\n  private accountCache$: Observable<Account>;\n\n  constructor(private languageService: JhiLanguageService, private sessionStorage: SessionStorageService, private http: HttpClient) {}\n\n  fetch(): Observable<Account> {\n    return this.http.get<Account>(SERVER_API_URL + 'api/account');\n  }\n\n  save(account: Account): Observable<Account> {\n    return this.http.post<Account>(SERVER_API_URL + 'api/account', account);\n  }\n\n  authenticate(identity) {\n    this.userIdentity = identity;\n    this.authenticated = identity !== null;\n    this.authenticationState.next(this.userIdentity);\n  }\n\n  hasAnyAuthority(authorities: string[] | string): boolean {\n    if (!this.authenticated || !this.userIdentity || !this.userIdentity.authorities) {\n      return false;\n    }\n\n    if (!Array.isArray(authorities)) {\n      authorities = [authorities];\n    }\n\n    return authorities.some((authority: string) => this.userIdentity.authorities.includes(authority));\n  }\n\n  identity(force?: boolean): Observable<Account> {\n    if (force || !this.authenticated) {\n      this.accountCache$ = null;\n    }\n\n    if (!this.accountCache$) {\n      this.accountCache$ = this.fetch().pipe(\n        catchError(() => {\n          return of(null);\n        }),\n        tap(account => {\n          if (account) {\n            this.userIdentity = account;\n            this.authenticated = true;\n            // After retrieve the account info, the language will be changed to\n            // the user's preferred language configured in the account setting\n            if (this.userIdentity.langKey) {\n              const langKey = this.sessionStorage.retrieve('locale') || this.userIdentity.langKey;\n              this.languageService.changeLanguage(langKey);\n            }\n          } else {\n            this.userIdentity = null;\n            this.authenticated = false;\n          }\n          this.authenticationState.next(this.userIdentity);\n        }),\n        shareReplay()\n      );\n    }\n    return this.accountCache$;\n  }\n\n  isAuthenticated(): boolean {\n    return this.authenticated;\n  }\n\n  isIdentityResolved(): boolean {\n    return this.userIdentity !== undefined;\n  }\n\n  getAuthenticationState(): Observable<any> {\n    return this.authenticationState.asObservable();\n  }\n\n  getImageUrl(): string {\n    return this.isIdentityResolved() ? this.userIdentity.imageUrl : null;\n  }\n}\n"]}]}